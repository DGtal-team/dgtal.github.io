<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<title>DGtalTools: Image restoration and inpainting with Ambrosio-Tortorelli functional</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="modern-doxygen-green.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DGtalTools 
   &#160;<span id="projectnumber">1.2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Image restoration and inpainting with Ambrosio-Tortorelli functional </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#AT1">The Ambrosio-Tortorelli functional  &lt;br&gt;</a></li>
<li class="level1"><a href="#AT2">Discretization of AT with discrete calculus</a><ul><li class="level2"><a href="#AT2_1">Discrete Calculus</a></li>
<li class="level2"><a href="#AT2_2">Formulations AT01 and AT20</a></li>
<li class="level2"><a href="#AT2_3">Solutions to AT01 and AT20</a></li>
<li class="level2"><a href="#AT2_4">Algorithm</a></li>
</ul>
</li>
<li class="level1"><a href="#AT3">Piecewise smooth approximation of images</a><ul><li class="level2"><a href="#AT3_1">Some examples of restoration and discontinuity detections</a></li>
<li class="level2"><a href="#AT3_2">Influence of parameter epsilon</a></li>
<li class="level2"><a href="#AT3_3">Influence of parameter alpha</a></li>
<li class="level2"><a href="#AT3_4">Influence of parameter lambda</a></li>
</ul>
</li>
<li class="level1"><a href="#AT4">Use of AT models for inpainting</a></li>
<li class="level1"><a href="#AT5">A variant for AT model</a></li>
<li class="level1"><a href="#ATref">References</a></li>
</ul>
</div>
<div class="textblock"><dl class="section user"><dt>Author(s) of this documentation:\n Marion Foare and Jacques-Olivier Lachaud</dt><dd></dd></dl>
<p>Part of tool <a class="el" href="imageProcessing.html">Image processing</a>.</p>
<ul>
<li>related tools: <a class="el" href="DocATu2v0.html">imageProcessing/at-u2-v0</a>, <a class="el" href="DocATVu2v0.html">imageProcessing/atv-u2-v0</a>, <a class="el" href="DocATu0v1.html">imageProcessing/at-u0-v1</a></li>
<li>related classes: <a class="el" href="structDGtal_1_1ATu0v1.html">DGtal::ATu0v1</a>, <a class="el" href="structDGtal_1_1ATu2v0.html">DGtal::ATu2v0</a>, <a class="el" href="structDGtal_1_1ATVu2v0.html">DGtal::ATVu2v0</a>, <a class="el" href="structDGtal_1_1DECImage2D.html">DGtal::DECImage2D</a></li>
<li>related namespace: <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html">DGtal::functions::dec</a></li>
<li>related functions: <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#ad9fb26d47ad401b3c03352935a26d653">DGtal::functions::dec::diagonal</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#af357eec2548f18bfb57f22a401d939a3">DGtal::functions::dec::squares</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#a7baa4898c67d1b806bf9fbe184633f68">DGtal::functions::dec::squaredDiagonal</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#aaa4c8cd28542bfcc448411aa12b2ac0f">DGtal::functions::dec::writePixel</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#a2ad6648879b4fe80dd4bf478093afc58">DGtal::functions::dec::writePrimalLinel</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#abd45f566de4244177a273ab58211fe27">DGtal::functions::dec::writeDualLinel</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#a0e6468a2500539a58154ad4306ee5905">DGtal::functions::dec::form2ToImage</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#a3cc22a515214f5d66476709f7e79c5eb">DGtal::functions::dec::form1ToImage</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#a7fd12bedfdc0cb9d387cac611954ca9e">DGtal::functions::dec::dualForm1ToImage</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#a1aac0287d103cd7d32bdd2d5d1f59733">DGtal::functions::dec::primalForm1ToImage</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#af0f1984b7bce933f879ba34366feceb8">DGtal::functions::dec::threeForms2ToImage</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#a4b9ac337cafc1eca676005ee618347da">DGtal::functions::dec::form2ToGreyLevelImage</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#a00c503c31f47b9d6a50230a6ba6f3acf">DGtal::functions::dec::primalForm1ToGreyLevelImage</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#a1ae55a77c01a4a05f11c753f048cd77a">DGtal::functions::dec::dualForm1ToGreyLevelImage</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#aced45cf3f95402bcd4f13f853e2beee5">DGtal::functions::dec::primalForm1ToRGBColorImage</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#a69a0b5992fc0b6286c67e29e5fa93c32">DGtal::functions::dec::dualForm1ToRGBColorImage</a>, <a class="el" href="namespaceDGtal_1_1functions_1_1dec.html#abbd5561c8b9fc45a241040c5e9140487">DGtal::functions::dec::threeForms2ToRGBColorImage</a>.</li>
</ul>
<h1><a class="anchor" id="AT1"></a>
The Ambrosio-Tortorelli functional  &lt;br&gt;</h1>
<p>The Ambrosio-Tortorelli functional is a classical relaxation of the Mumford-Shah functional.</p>
<p>Given an input grayscale image, defined in an open bounded domain \( \Omega \), we represent its gray levels by a function \( g \in L^{\infty}(\Omega) \). In the Ambrosio-Tortorelli functional [1], one wants to find a function \( u \in SBV(\Omega) \) which is a smooth approximation of the input image \( g \). The Ambrosio-Tortorelli functional [1] is defined by </p><p class="formulaDsp">
\[ \displaystyle AT_{\varepsilon}(u,v) = \int_\Omega \alpha |u-g|^2 + v^2 |\nabla u|^2 + \lambda \varepsilon |\nabla v|^2 + \frac{\lambda}{4 \varepsilon} |1-v|^2 dx, \]
</p>
<p> for functions \( u,v \in W^{1,2}(\Omega)\) with \( 0 \leq v \leq 1 \).</p>
<p>In AT functional, function \( v \) is a smooth approximation of the set of discontinuities, and takes value close to 0 in this set, while being close to 1 outside discontinuities. A remarkable property of this functional is that it \( \Gamma \)-converges to (a relaxation of) MS functional as \( \varepsilon \) tends to 0 (see [1]). The intuition is that a large \( \varepsilon \) induces a solution with a fuzzy set of discontinuities, which is then progressively narrowed to the crisp 1-dimensional set of discontinuites as \( \varepsilon \) goes to 0.</p>
<h1><a class="anchor" id="AT2"></a>
Discretization of AT with discrete calculus</h1>
<h2><a class="anchor" id="AT2_1"></a>
Discrete Calculus</h2>
<p>The idea is to decompose the image domain \( \Omega \) into a cell complex <em>K</em>. Here, the faces of <em>K</em> are simply the pixels of the image, the edges of <em>K</em> are the sides shared by two pixels, while the vertices of <em>K</em> are the vertices shared by four pixels. For technical reasons, the dual complex <em>K'</em> of <em>K</em> is also needed and is defined in the usual way: a vertex of <em>K</em> is thus associated one-to-one to a face of <em>K'</em>, etc. A discrete \( k \)-form is a map that associates a scalar to a \( k \)-dimensional cell. If the number of \( k \)-dimensional cells of <em>K</em> is denoted by \( n_k \), then a discrete \( k \)-form is simply represented by a column vector of size \( n_k \times 1 \).</p>
<p>We denote by \( \mathbf{d_k} \) and \( \bar{\mathbf{d_k}} \) the standard discrete exterior primal and dual derivative operators. The derivative operator \( \mathbf{d_0} \) is the oriented vertex-edge incidence matrix of <em>K</em>. Similarly, the primal derivative \( \mathbf{d_1} \) is the oriented edge-face incidence matrix of <em>K</em>.</p>
<p>Discrete Hodge star operators \( \mathbf{\star} \) send \( k \)-forms of the primal complex <em>K</em> onto \( (n-k) \)-forms of the dual complex <em>K'</em>. Of course, there are dual Hodge star operators \( \bar{\mathbf{\star}} \) which send \( k \)-forms of the dual complex <em>K'</em> onto \( (n-k) \)-forms of the primal complex <em>K'</em>. The composition of \( \mathbf{\star} \) with its dual \( \bar{\mathbf{\star}} \) is idempotent except for a sign change in some cases, i.e. \( \bar{\mathbf{\star}} \mathbf{\star} = (-1)^{k(n-k)} \mathbf{Id} \).</p>
<p>We define \( \mathbf{M} \) the matrix which transforms a 0-form into a 1-form by averaging the values on the two edge extremities, i.e. \( \mathbf{M} = \frac{1}{2} |\mathbf{d_0}| \). Moreover, we use the edge laplacian defined in [5] by \( \bar{\mathbf{\star}} \bar{\mathbf{d_0}} \mathbf{\star} \mathbf{d_1} + \mathbf{d_0} \bar{\mathbf{\star}} \bar{\mathbf{d_1}} \mathbf{\star} \).</p>
<h2><a class="anchor" id="AT2_2"></a>
Formulations AT01 and AT20</h2>
<p>We first set \( u \) and \( g \) to live on the faces and \( v \) to live on the vertices and edges. Pixels are faces, so functions \( u \) and \( g \) are 2-forms since they represent the gray levels of each pixel. On the contrary, we set \( v \) in-between cells of non null measure, so in this case on vertices as a 0-form, and on edges by averaging with \( \mathbf{M} \). We call this formulation AT20. The DEC reformulation is straightforward, except for the second term, where we use matrix \( \mathbf{M} \) to transport the 0-form \( v \) onto edges : </p><p class="formulaDsp">
\[ \displaystyle AT20(u,v) = \Sigma_{i=1}^n \alpha \langle u_i - g_i , u_i - g_i \rangle_2 + \langle \mathbf{M} v , \bar{\mathbf{\star}} \bar{\mathbf{d_0}} \mathbf{\star} u_i \rangle_1 ^2 \\ + \lambda \varepsilon \langle \mathbf{d_0} v , \mathbf{d_0} v \rangle_1 + \frac{\lambda}{4\varepsilon} \langle 1 - v , 1 - v \rangle_0. \]
</p>
<p>A second possibility is to define \( u \) and \( g \) on the vertices and \( v \) on the edges. We denote this formulation AT01. Gray levels are seen as point mass on the center of pixels, so that functions \( u \) and \( g \) are both 0-forms, while \( v \) is a dual 1-form in between \( u \). It follows: </p><p class="formulaDsp">
\[ \displaystyle AT01(u,v) = \Sigma_{i=1}^n \alpha \langle u_i - g_i , u_i - g_i \rangle_0 + \langle v , \mathbf{d_0} u_i \rangle_1 \langle v , \mathbf{d_0} u_i \rangle_1 \\ + \lambda \varepsilon \langle (\mathbf{d_1} + \bar{\mathbf{\star}} \bar{\mathbf{d_1}} \mathbf{\star}) v , (\mathbf{d_1} + \bar{\mathbf{\star}} \bar{\mathbf{d_1}} \mathbf{\star}) v \rangle_1 + \frac{\lambda}{4\varepsilon} \langle 1 - v , 1 - v \rangle_1. \]
</p>
<p>For more details about discrete formulations and numerical optimizationf of AT, we refer the reader to [2] and [3].</p>
<h2><a class="anchor" id="AT2_3"></a>
Solutions to AT01 and AT20</h2>
<p>Functionals AT20 and AT01 are both sums of quadratic terms, independently, but not simultaneously, convex in \( u \) and \( v \). They must have null derivative at optimum. We thus propose to alternatively solve for \( u \), then \( v \). The derivatives can be given explicitly as linear systems. To simplify notations, let \( \mathbf{A} := \mathbf{d_0} \), \( \mathbf{B} := \mathbf{d_1} \), \( \mathbf{A&#39;} := \bar{\mathbf{\star}} \bar{\mathbf{d_1}} \mathbf{\star} \) and \( \mathbf{B&#39;} := \bar{\mathbf{\star}} \bar{\mathbf{d_0}} \mathbf{\star} \). We get at optimum: </p><p class="formulaDsp">
\[ \displaystyle \left\{ \begin{array}{r @{=} l c} \left[\alpha \mathbf{Id} - {\mathbf{B&#39;}}^T diag(\mathbf{M} v)^2 \mathbf{B&#39;} \right] u &amp; = \quad \alpha g &amp; (1.1) \\ \left[ \frac{\lambda}{4\varepsilon} \mathbf{Id} + \lambda \varepsilon \mathbf{A}^T \mathbf{A} + \mathbf{M}^T diag(\mathbf{B&#39;} u)^2 \mathbf{M} \right] v &amp; = \quad \frac{\lambda}{4 \varepsilon} \mathbf{1} &amp; (1.2) \end{array}\right. \]
</p>
<p>for the derivative of AT20, and</p>
<p class="formulaDsp">
\[ \displaystyle \left\{ \begin{array}{r @{=} l c} \left[\alpha \mathbf{Id} - \mathbf{A}^T diag(v)^2 \mathbf{A} \right] u &amp; = \quad \alpha g &amp; (2.1) \\ \left[ \frac{\lambda}{4\varepsilon} \mathbf{Id} + \lambda \varepsilon (\mathbf{A&#39;}^T \mathbf{A&#39;} + \mathbf{B}^T \mathbf{B}) + diag(\mathbf{A} u)^2 \right] v &amp; = \quad \frac{\lambda}{4 \varepsilon} \mathbf{1} &amp; (2.2) \end{array}\right. \]
</p>
<p> for the derivative of AT01. Since all matrices are symmetric, definite and positive, we use a Cholesky factorization to solve alternatively the two equations of each system.</p>
<h2><a class="anchor" id="AT2_4"></a>
Algorithm</h2>
<p>\( \begin{array}{l l l l} \rlap{OPTIMIZE-AT01( (g_1, ..., g_N ): 0-forms, (\alpha, \lambda, \varepsilon_1, \varepsilon_2, \varepsilon_r): reals );} \\ \rlap{\mathbf{Var~} (u_1, ..., u_N): 0-forms, (v, v&#39;): 1-forms, \varepsilon: real ; } \\ \rlap{\mathbf{begin}} &amp; \\ &amp; \rlap{\mathbf{foreach~} i \in \{1, 2, 3\} \mathbf{~do~} u_i \leftarrow g_i;} \\ &amp; \rlap{v \leftarrow 1, \varepsilon \leftarrow \varepsilon_1;} \\ &amp; \rlap{\mathbf{while~} \varepsilon \geq \varepsilon_2 \mathbf{~do~}} \\ &amp; &amp; \rlap{\mathbf{repeat}} \\ &amp; &amp; &amp; v&#39; \leftarrow v; \\ &amp; &amp; &amp; \hbox{Solve Eq.(1.1) for all } u_i ; \\ &amp; &amp; &amp; \hbox{Solve Eq.(1.2) for } v ; \\ &amp; &amp; \rlap{\mathbf{until~} ||v - v&#39;|| \hbox{~is small;}} \\ &amp; &amp; \rlap{\varepsilon \leftarrow \varepsilon / \varepsilon_r;} \\ &amp; \rlap{\mathbf{end}} \\ \rlap{\mathbf{end}} \end{array} \)</p>
<h1><a class="anchor" id="AT3"></a>
Piecewise smooth approximation of images</h1>
<h2><a class="anchor" id="AT3_1"></a>
Some examples of restoration and discontinuity detections</h2>
<p>We display below the different resconstructions of image "lena" with approximately 20% noise, for varying parameter \( \lambda \). Note that a too big \( \lambda \) gives a fuzzy result, while a too small \( \lambda \) keeps noise.</p>
<center> <table class="doxtable">
<tr>
<td>Input <em>g</em>  </td><td><div class="image">
<img src="lena-370-b02.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="lena-370-b02.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="lena-370-b02.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="lena-370-b02.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="lena-370-b02.png" alt=""/>
</div>
  </td></tr>
<tr>
<td>Approx. <em>u</em>  </td><td><div class="image">
<img src="lena-370-b02-a0_48000-l0_2000000-u.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="lena-370-b02-a0_48000-l0_1000000-u.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="lena-370-b02-a0_48000-l0_0500000-u.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="lena-370-b02-a0_48000-l0_0250000-u.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="lena-370-b02-a0_48000-l0_0125000-u.png" alt=""/>
</div>
  </td></tr>
<tr align="center">
<td>\( \alpha = 0.48, \varepsilon = 4 \searrow 0.25 \)  </td><td>\( \lambda = 0.2 \)  </td><td>\( \lambda = 0.1 \)  </td><td>\( \lambda = 0.05 \)  </td><td>\( \lambda = 0.025 \)  </td><td>\( \lambda = 0.0125 \)   </td></tr>
</table>
</center><div class="fragment"><div class="line">./imageProcessing/at-u2-v0 -i ../imageProcessing/Images/lena-370-b02.ppm -o lena-370-b02 -a 0.48 --lambda-1 0.2 --lambda-2 0.0125 --lambda-ratio 2.0 --epsilon-1 4.0 --epsilon-2 0.25 -p 2 -n 20</div>
</div><!-- fragment --><div class="image">
<img src="lena-370-b02-a0_48000-l0_0500000-u-v.png" alt=""/>
<div class="caption">
Result of <em>u</em> and <em>v</em> for lambda=0.05, discontinuities are in a red.</div></div>
<p>Our approach allows us to restore images with texture, as illustrated below on image "barbara" with noise approximately 10%.</p>
<center> <table class="doxtable">
<tr>
<td><div class="image">
<img src="barbara-cropped-b01.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="barbara-cropped-b01-l0.0054088-a1.0-u0-v1-u.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="Barbara_Crop_ATu2v0.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="Barbara_Crop_ATu0v1.png" alt=""/>
</div>
  </td></tr>
<tr align="center">
<td>Input image <em>g</em>  </td><td>Approx. <em>u</em> with AT20 and AT01  </td><td><em>u</em> and <em>v</em> with AT20  </td><td><em>u</em> and <em>v</em> with AT01   </td></tr>
<tr>
<td>Command line are:  </td><td align="center" colspan="3"><div class="fragment"><div class="line">./imageProcessing/at-u2-v0 -i ../imageProcessing/Images/barbara-cropped-b01.pgm -o barbara  -a 1.0 --lambda 0.0054  --epsilon-1 2.0 --epsilon-2 0.25 </div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/barbara-cropped-b01.pgm -o barbara  -a 0.69 --lambda 0.0065  --epsilon-1 2.0 --epsilon-2 0.25 </div>
</div><!-- fragment -->   </td></tr>
</table>
</center><h2><a class="anchor" id="AT3_2"></a>
Influence of parameter epsilon</h2>
<center> <table class="doxtable">
<tr>
<td><div class="image">
<img src="carre2Degradesb02.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="cb2-e4_0-a0_10000-l0_0062092-u0-v1.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="cb2-e2_0-a0_10000-l0_0062092-u0-v1.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="cb2-e1_0-a0_10000-l0_0062092-u0-v1.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="cb2-e0_5-a0_10000-l0_0062092-u0-v1.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="cb2-e0_25-a0_10000-l0_0062092-u0-v1.png" alt=""/>
</div>
  </td></tr>
<tr align="center">
<td>Input image <em>g</em>  </td><td>\( \varepsilon = 4 \searrow 4 \)  </td><td>\( \varepsilon = 4 \searrow 2 \)  </td><td>\( \varepsilon = 4 \searrow 1 \)  </td><td>\( \varepsilon = 4 \searrow 0.5 \)  </td><td>\( \varepsilon = 4 \searrow 0.25 \)   </td></tr>
<tr>
<td>Command lines are: </td><td align="center" colspan="5"><div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/carre2Degradesb02.pgm -o cb2 -a 0.1 --lambda 0.006 --epsilon-1 4.0 --epsilon-2 4.0 </div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/carre2Degradesb02.pgm -o cb2 -a 0.1 --lambda 0.006 --epsilon-1 4.0 --epsilon-2 2.0 </div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/carre2Degradesb02.pgm -o cb2 -a 0.1 --lambda 0.006 --epsilon-1 4.0 --epsilon-2 1.0 </div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/carre2Degradesb02.pgm -o cb2 -a 0.1 --lambda 0.006 --epsilon-1 4.0 --epsilon-2 0.5 </div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/carre2Degradesb02.pgm -o cb2 -a 0.1 --lambda 0.006 --epsilon-1 2.0 --epsilon-2 0.25 </div>
</div><!-- fragment -->   </td></tr>
</table>
</center><h2><a class="anchor" id="AT3_3"></a>
Influence of parameter alpha</h2>
<center> <table class="doxtable">
<tr>
<td><div class="image">
<img src="carre2Degradesb02.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="cb2-a1_00000-l1_0000000-u.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="cb2-a0_50000-l1_0000000-u.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="cb2-a0_10000-l1_0000000-u.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="cb2-a0_05000-l1_0000000-u.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="cb2-a0_01000-l1_0000000-u.png" alt=""/>
</div>
  </td></tr>
<tr align="center">
<td>\( \lambda = 1.0, \epsilon = 2 \searrow 0.25 \)  </td><td>\( \alpha = 1.0 \)  </td><td>\( \alpha = 0.5 \)  </td><td>\( \alpha = 0.1 \)  </td><td>\( \alpha = 0.05 \)  </td><td>\( \alpha = 0.01 \)   </td></tr>
<tr>
<td>Command lines are: </td><td align="center" colspan="5"><div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/carre2Degradesb02.pgm -o cb2 -a 1.0 --lambda 1.0 --epsilon-1 2.0 --epsilon-2 0.25 </div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/carre2Degradesb02.pgm -o cb2 -a 0.5 --lambda 1.0 --epsilon-1 2.0 --epsilon-2 0.25 </div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/carre2Degradesb02.pgm -o cb2 -a 0.1 --lambda 1.0 --epsilon-1 2.0 --epsilon-2 0.25 </div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/carre2Degradesb02.pgm -o cb2 -a 0.05 --lambda 1.0 --epsilon-1 2.0 --epsilon-2 0.25 </div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/carre2Degradesb02.pgm -o cb2 -a 0.01 --lambda 1.0 --epsilon-1 2.0 --epsilon-2 0.25 </div>
</div><!-- fragment -->   </td></tr>
</table>
</center><h2><a class="anchor" id="AT3_4"></a>
Influence of parameter lambda</h2>
<center> <table class="doxtable">
<tr>
<td><div class="image">
<img src="triple-spirale-b02.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="Triangle_0_1.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="Triangle_0_01.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="Triangle_0_0048.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="Triangle_0_0011.png" alt=""/>
</div>
  </td></tr>
<tr align="center">
<td>Input image <em>g</em>  </td><td>\( \lambda = 0.1 \)  </td><td>\( \lambda = 0.01 \)  </td><td>\( \lambda = 0.0048 \)  </td><td>\( \lambda = 0.0011 \)   </td></tr>
<tr>
<td>Command lines are: </td><td align="center" colspan="4"><div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/triple-spirale-b02.pgm -o tb2 -a 0.162 --lambda 0.1 --epsilon-1 1.0 --epsilon-2 0.25</div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/triple-spirale-b02.pgm -o tb2 -a 0.162 --lambda 0.01 --epsilon-1 1.0 --epsilon-2 0.25</div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/triple-spirale-b02.pgm -o tb2 -a 0.162 --lambda 0.0048 --epsilon-1 1.0 --epsilon-2 0.25</div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/triple-spirale-b02.pgm -o tb2 -a 0.162 --lambda 0.0011 --epsilon-1 1.0 --epsilon-2 0.25</div>
</div><!-- fragment -->   </td></tr>
</table>
</center><h1><a class="anchor" id="AT4"></a>
Use of AT models for inpainting</h1>
<p>The AT20 model is much superior to the AT01 model for inpainting since it is less sensitive to L1-metrication artefacts. Indeed, for large \( \varepsilon \), the discontinuity set is averaged along points, not along edges. Hence AT20 is smoothed in all directions while AT01 is smoothed along axes. This is illustrated on the inpainting quadruple angle below. AT01 finds the solution in the L1-metric sense for the length of discontinuities, while AT20 finds the correct two triple points in the L2-metric sense.</p>
<center> <table class="doxtable">
<tr>
<td><div class="image">
<img src="q2-d2-g-mask.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="q2-d-a0_10000-l0_0620921-u.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="q2-d2-a1.00000-l0.0100000-u2-v0.png" alt=""/>
</div>
  </td></tr>
<tr>
<td><div class="image">
<img src="q452-d-g-mask.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="q452-d-a0_10000-l0_0289664-u.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="q452-d-a1.00000-l0.0250000-u2-v0.png" alt=""/>
</div>
  </td></tr>
<tr align="center">
<td>Input <em>g</em> + mask  </td><td>Inpainted <em>u</em> with AT01  </td><td>Inpainted <em>u</em> with AT20   </td></tr>
<tr>
<td>Command lines are: </td><td align="center" colspan="2"><div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/quadruple-color.ppm -o q -m ../imageProcessing/Images/mask-big-disc.pgm -a 1.0 --lambda 0.01 --epsilon-1 4.0 --epsilon-2 0.25</div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u0-v1 -i ../imageProcessing/Images/quadruple-45-color.ppm -o q -m ../imageProcessing/Images/mask-disc.pgm -a 1.0 --lambda 0.025 --epsilon-1 4.0 --epsilon-2 0.25</div>
</div><!-- fragment --><div class="fragment"><div class="line">./imageProcessing/at-u2-v0 -i ../imageProcessing/Images/quadruple-color.ppm -o q -m ../imageProcessing/Images/mask-big-disc.pgm -a 1.0 --lambda 0.01 --epsilon-1 4.0 --epsilon-2 0.25</div>
</div><!-- fragment --> <div class="fragment"><div class="line">./imageProcessing/at-u2-v0 -i ../imageProcessing/Images/quadruple-45-color.ppm -o q -m ../imageProcessing/Images/mask-disc.pgm -a 1.0 --lambda 0.025 --epsilon-1 4.0 --epsilon-2 0.25</div>
</div><!-- fragment -->   </td></tr>
</table>
</center><h1><a class="anchor" id="AT5"></a>
A variant for AT model</h1>
<p>Following ideas from Elie Bretin and Simon Masnou (Institut Camille Jordan), it is possible to approximate the Hausdorff 1-measure of singularities using the Laplacian of v instead of its gradient. The functional becomes:</p>
<p class="formulaDsp">
\[ \displaystyle AT_{\varepsilon}(u,v) = \int_\Omega \alpha |u-g|^2 + v^2 |\nabla u|^2 + c \lambda \varepsilon |\Delta v|^2 + c \frac{\lambda}{\varepsilon} |1-v|^2 dx, \]
</p>
<p>It \( \Gamma \)-converges to a length estimation multiplied by \(2 \sqrt{2}\), while having a smoother profile than the standard AT. The constant c is set to \(1/(2 \sqrt{2})\) to correct this estimation and to keep the same parameterization as AT.</p>
<p>In ATV functional, function \( v \) is a smooth approximation of the set of discontinuities, and takes value close to 0 in this set, while being close to 1 outside discontinuities. A remarkable property of this functional is that it \( \Gamma \)-converges to (a relaxation of) MS functional as \( \varepsilon \) tends to 0 (see [1]). The intuition is that a large \( \varepsilon \) induces a solution with a fuzzy set of discontinuities, which is then progressively narrowed to the crisp 1-dimensional set of discontinuites as \( \varepsilon \) goes to 0.</p>
<p>We discretize ATV with discrete calculus and we set \( u \) and \( g \) to live on the faces and \( v \) to live on the vertices and edges. Pixels are faces, so functions \( u \) and \( g \) are 2-forms since they represent the gray levels of each pixel. On the contrary, we set \( v \) in-between cells of non null measure, so in this case on vertices as a 0-form, and on edges by averaging with \( \mathbf{M} \). We call this formulation ATV20. The DEC reformulation is straightforward, except for the second term, where we use matrix \( \mathbf{M} \) to transport the 0-form \( v \) onto edges :</p>
<p class="formulaDsp">
\[ \displaystyle ATV20(u,v) = \Sigma_{i=1}^n \alpha \langle u_i - g_i , u_i - g_i \rangle_2 + \langle \mathbf{M} v , \bar{\mathbf{\star}} \bar{\mathbf{d_0}} \mathbf{\star} u_i \rangle_1 ^2 \\ + c \lambda \varepsilon \langle \mathbf{L_0} v , \mathbf{L_0} v \rangle_1 + c \frac{\lambda}{4\varepsilon} \langle 1 - v , 1 - v \rangle_0. \]
</p>
<p>Here is an example.</p>
<div class="fragment"><div class="line">./imageProcessing/atv-u2-v0 -i ../imageProcessing/Images/degrade-b04.pgm --image-snr ../imageProcessing/Images/degrade.pgm -a 0.05 --epsilon-1 4 --epsilon-2 0.25 -l 0.0075 -p 2 -c 0xff0000 -o degrade</div>
</div><!-- fragment --><center> <table class="doxtable">
<tr>
<td>Input image <em>g</em>  </td><td>Reconstructed image ATV <em>u</em>  </td><td>Reconstructed image TV <em>u</em> (for comparison)  </td><td>Perfect image   </td></tr>
<tr>
<td><div class="image">
<img src="degrade-b04.png" alt=""/>
<div class="caption">
Input image (noise = 0.4)</div></div>
 </td><td><div class="image">
<img src="degrade-atv-a0.05000-l0.0075000-u.png" alt=""/>
<div class="caption">
ATV20 alpha=0.05 lambda=0.0075 </div></div>
 </td><td><div class="image">
<img src="degrade-a0.05000-l0.0075000-u2.png" alt=""/>
<div class="caption">
AT20 alpha=0.05 lambda=0.0075 </div></div>
 </td><td><div class="image">
<img src="degrade.png" alt=""/>
<div class="caption">
Perfect image</div></div>
  </td></tr>
<tr>
<td>SNR of <em>g</em> = 21.9183  </td><td>SNR of <em>u</em> = 34.3261  </td><td>SNR of <em>u</em> = 34.3655  </td><td>Perfect image   </td></tr>
</table>
</center><dl class="section note"><dt>Note</dt><dd>After some experiments, pratical results are very similar to <code>at-u2-v0</code>. Timings are longer since \( | \Delta v |^2 \) induces less sparse matrices.</dd></dl>
<h1><a class="anchor" id="ATref"></a>
References</h1>
<p>[1] Luigi Ambrosio, and Vincenzo Maria Tortorelli. "Approximation of functional depending on jumps by elliptic functional via \(\Gamma\)‐convergence." Communications on Pure and Applied Mathematics 43.8 (1990): 999-1036.</p>
<p>[2] Marion Foare, Jacques-Olivier Lachaud, and Hugues Talbot. "Image restoration
and segmentation using the Ambrosio-Tortorelli functional and discrete calculus." In Proceedings of the IAPR International Conference on Pattern Recognition (ICPR2016), Cancun, Mexico, 2016.</p>
<p>[3] Marion Foare, Jacques-Olivier Lachaud, and Hugues Talbot. "Numerical implementation of the Ambrosio-Tortorelli functional using discrete calculus and application to image restoration and inpainting." In Proceedings of 1st Workshop on Reproducible Research In Pattern Recognition (RRPR 2016), Springer LNCS. To appear.</p>
<p>[4] Matteo Focardi. "On the variational approximation of free-
discontinuity problems in the vectorial case." Mathematical Models and Methods in Applied Sciences 11.04 (2001): 663-684.</p>
<p>[5] Leo J. Grady and Jonathan Polimeni. Discrete calculus: Applied analysis on graphs for computational science . Springer, 2010. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Companion project associated to  <a href= "http://liris.cnrs.fr/dgtal/doc/nightly/"> DGtal </a>;
    Generated on Wed Jun 2 2021 15:34:52 for DGtalTools by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.1
</small></address>
</body>
</html>
