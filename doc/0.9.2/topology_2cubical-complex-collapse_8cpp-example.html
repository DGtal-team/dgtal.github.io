<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>DGtal: topology/cubical-complex-collapse.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="modern-doxygen-blue.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DGtal
   &#160;<span id="projectnumber">0.9.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">topology/cubical-complex-collapse.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Collapse of 3D cubical complex that is made of 20x20x20 voxels with their faces. Fixed cells were marked in red. It was the eight vertices, plus all border linels on the upper faces plus a random linel within the complex. The priority was the distance to the diagonal. Note that the Euler characteristic of the complex is unchanged after collapse.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="moduleCubicalComplex.html#dgtal_ccomplex_sec7">Topological operations: closing, opening, collapsing a complex</a></dd></dl>
<pre class="fragment">$ ./examples/topology/cubical-complex-collapse
New Block [Creating Cubical Complex]
  After close: [CubicalComplex dim=3 chi=1 #0=9261 #1=26460 #2=25200 #3=8000]
EndBlock [Creating Cubical Complex] (12.088 ms)
New Block [Collapsing complex]
  [CC::collapse]-+ tag collapsible elements...    68756 found.
  [CC::collapse]-+ entering collapsing loop. 
  [CC::collapse]---+ Pass 1, Card(PQ)=68921 elements, nb_exam=0
  [CC::collapse]---+ Pass 2, Card(PQ)=16219 elements, nb_exam=68921
  [CC::collapse]---+ Pass 3, Card(PQ)=7956 elements, nb_exam=85140
  [CC::collapse]---+ Pass 4, Card(PQ)=36 elements, nb_exam=93096
  [CC::collapse]-+ cleaning complex.
  Collapse removed 64066 cells.
  After collapse: [CubicalComplex dim=2 chi=1 #0=1268 #1=2427 #2=1160 #3=0]
EndBlock [Collapsing complex] (162.069 ms)
$
</pre><div class="image">
<img src="cubical-complex-collapse-snapshot.png" alt="cubical-complex-collapse-snapshot.png"/>
<div class="caption">
Collapse of a cubical complex made of 20x20x20 voxels with some cells marked as fixed (in red).</div></div>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/base/Common.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/helpers/StdDefs.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/io/DrawWithDisplay3DModifier.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/io/viewers/Viewer3D.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/topology/KhalimskySpaceND.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/topology/CubicalComplex.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/topology/CubicalComplexFunctions.h&quot;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceDGtal.html">DGtal</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceDGtal_1_1Z3i.html">DGtal::Z3i</a>;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> CubicalComplex&gt;</div>
<div class="line"><span class="keyword">struct </span>DiagonalPriority {</div>
<div class="line">  <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="classDGtal_1_1CubicalComplex.html#a2d2018bde3a694fa1cca39f5965019e0">CubicalComplex::KSpace</a> <a name="_a0"></a><a class="code" href="classDGtal_1_1KhalimskySpaceND.html">KSpace</a>;</div>
<div class="line">  <span class="keyword">typedef</span> <span class="keyword">typename</span> <a name="_a1"></a><a class="code" href="classDGtal_1_1PointVector.html">CubicalComplex::Point</a>  <a class="code" href="classDGtal_1_1PointVector.html">Point</a>;</div>
<div class="line">  <span class="keyword">typedef</span> <span class="keyword">typename</span> <a name="_a2"></a><a class="code" href="structDGtal_1_1KhalimskyCell.html">CubicalComplex::Cell</a>   <a class="code" href="structDGtal_1_1KhalimskyCell.html">Cell</a>;</div>
<div class="line">  <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="classDGtal_1_1CubicalComplex.html#ab6e8cc82489babad5a1cd7596a02ac14">CubicalComplex::CellMapIterator</a> CellMapIterator;</div>
<div class="line">  </div>
<div class="line">  DiagonalPriority( <span class="keyword">const</span> <a name="_a3"></a><a class="code" href="classDGtal_1_1CubicalComplex.html">CubicalComplex</a>&amp; complex ) : myComplex( complex ) {}</div>
<div class="line">  <span class="keywordtype">bool</span> operator()( <span class="keyword">const</span> CellMapIterator&amp; it1, <span class="keyword">const</span> CellMapIterator&amp; it2 )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    Point k1 = myComplex.space().uKCoords( it1-&gt;first );</div>
<div class="line">    Point k2 = myComplex.space().uKCoords( it2-&gt;first );</div>
<div class="line">    <span class="keywordtype">double</span> d1 = Point::diagonal( 1 ).dot( k1 ) / sqrt( (<span class="keywordtype">double</span>) KSpace::dimension );</div>
<div class="line">    <span class="keywordtype">double</span> d2 = Point::diagonal( 1 ).dot( k2 ) / sqrt( (<span class="keywordtype">double</span>) KSpace::dimension );;</div>
<div class="line">    <a name="_a4"></a><a class="code" href="classDGtal_1_1PointVector.html">RealPoint</a> v1( k1[ 0 ] - d1 * k1[ 0 ], k1[ 1 ] - d1 * k1[ 1 ], k1[ 2 ] - d1 * k1[ 2 ] );</div>
<div class="line">    <a class="code" href="classDGtal_1_1PointVector.html">RealPoint</a> v2( k2[ 0 ] - d2 * k2[ 0 ], k2[ 1 ] - d2 * k2[ 1 ], k2[ 2 ] - d2 * k2[ 2 ] );</div>
<div class="line">    <span class="keywordtype">double</span> n1 = v1.<a name="a5"></a><a class="code" href="classDGtal_1_1PointVector.html#aa0bb99ecab1fcb8a34f94dde061f6eac">dot</a>( v1 );</div>
<div class="line">    <span class="keywordtype">double</span> n2 = v2.<a class="code" href="classDGtal_1_1PointVector.html#aa0bb99ecab1fcb8a34f94dde061f6eac">dot</a>( v2 );</div>
<div class="line">    <span class="keywordflow">return</span> ( n1 &lt; n2 ) || ( ( n1 == n2 ) &amp;&amp; ( it1-&gt;first &lt; it2-&gt;first ) );</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">const</span> <a class="code" href="classDGtal_1_1CubicalComplex.html">CubicalComplex</a>&amp; myComplex;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv )</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// JOL: unordered_map is approximately twice faster than map for</span></div>
<div class="line">  <span class="comment">// collapsing.</span></div>
<div class="line">  <span class="keyword">typedef</span> std::map&lt;Cell, CubicalCellData&gt; Map;</div>
<div class="line">  <span class="comment">// typedef boost::unordered_map&lt;Cell, CubicalCellData&gt;   Map;</span></div>
<div class="line">  <span class="keyword">typedef</span> <a class="code" href="classDGtal_1_1CubicalComplex.html">CubicalComplex&lt; KSpace, Map &gt;</a>     <a class="code" href="classDGtal_1_1CubicalComplex.html">CC</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a name="a6"></a><a class="code" href="classDGtal_1_1Trace.html#a352b7160bf722e2f0bcbee5d0bad6ef3">beginBlock</a>( <span class="stringliteral">&quot;Creating Cubical Complex&quot;</span> );</div>
<div class="line">  <a class="code" href="classDGtal_1_1KhalimskySpaceND.html">KSpace</a> K;</div>
<div class="line">  K.<a name="a7"></a><a class="code" href="classDGtal_1_1KhalimskySpaceND.html#a15dcbcaae831dd1c36090e6336c177d4">init</a>( <a class="code" href="classDGtal_1_1PointVector.html">Point</a>( 0,0,0 ), <a class="code" href="classDGtal_1_1PointVector.html">Point</a>( 512,512,512 ), <span class="keyword">true</span> );</div>
<div class="line">  CC complex( K );</div>
<div class="line">  <a class="code" href="namespaceDGtal_1_1Z3i.html#ae90d88848027490b2a61ab53fbb6a1b8">Integer</a> m = 40;</div>
<div class="line">  std::vector&lt;Cell&gt; S;</div>
<div class="line">  <span class="keywordflow">for</span> ( <a class="code" href="namespaceDGtal_1_1Z3i.html#ae90d88848027490b2a61ab53fbb6a1b8">Integer</a> x = 0; x &lt;= m; ++x )</div>
<div class="line">    <span class="keywordflow">for</span> ( <a class="code" href="namespaceDGtal_1_1Z3i.html#ae90d88848027490b2a61ab53fbb6a1b8">Integer</a> y = 0; y &lt;= m; ++y )</div>
<div class="line">      <span class="keywordflow">for</span> ( <a class="code" href="namespaceDGtal_1_1Z3i.html#ae90d88848027490b2a61ab53fbb6a1b8">Integer</a> z = 0; z &lt;= m; ++z )</div>
<div class="line">        {</div>
<div class="line">          <a class="code" href="classDGtal_1_1PointVector.html">Point</a> k1 = <a class="code" href="classDGtal_1_1PointVector.html">Point</a>( x, y, z ); </div>
<div class="line">          S.push_back( K.<a name="a8"></a><a class="code" href="classDGtal_1_1KhalimskySpaceND.html#adfec57bd5afe263eeeba523ed5a447fc">uCell</a>( k1 ) );</div>
<div class="line">          <span class="keywordtype">double</span> d1 = Point::diagonal( 1 ).dot( k1 ) / (double) KSpace::dimension; <span class="comment">// sqrt( (double) KSpace::dimension );</span></div>
<div class="line">          <a class="code" href="classDGtal_1_1PointVector.html">RealPoint</a> v1( k1[ 0 ], k1[ 1 ], k1[ 2 ] );</div>
<div class="line">          v1 -= d1 * RealPoint::diagonal( 1.0 );</div>
<div class="line">          <span class="comment">//RealPoint v1( k1[ 0 ] - d1 * k1[ 0 ], k1[ 1 ] - d1 * k1[ 1 ], k1[ 2 ] - d1 * k1[ 2 ] );</span></div>
<div class="line">          <span class="keywordtype">double</span> n1 = v1.norm();</div>
<div class="line">          <span class="keywordtype">bool</span> fixed = ( ( x == 0 ) &amp;&amp; ( y == 0 ) &amp;&amp; ( z == 0 ) )</div>
<div class="line">            || ( ( x == 0 ) &amp;&amp; ( y == m ) &amp;&amp; ( z == 0 ) )</div>
<div class="line">            || ( ( x == m ) &amp;&amp; ( y == 0 ) &amp;&amp; ( z == 0 ) )</div>
<div class="line">            || ( ( x == m ) &amp;&amp; ( y == m ) &amp;&amp; ( z == 0 ) )</div>
<div class="line">            || ( ( x == m/3 ) &amp;&amp; ( y == 2*m/3 ) &amp;&amp; ( z == 2*m/3 ) )</div>
<div class="line">            || ( ( x == 0 ) &amp;&amp; ( y == 0 ) &amp;&amp; ( z == m ) )</div>
<div class="line">            || ( ( x == 0 ) &amp;&amp; ( y == m ) &amp;&amp; ( z == m ) )</div>
<div class="line">            || ( ( x == m ) &amp;&amp; ( y == 0 ) &amp;&amp; ( z == m ) )</div>
<div class="line">            || ( ( x == m ) &amp;&amp; ( y == m ) &amp;&amp; ( z == m ) )</div>
<div class="line">            || ( ( x == 0 ) &amp;&amp; ( y == m ) )</div>
<div class="line">            || ( ( x == m ) &amp;&amp; ( y == m ) )</div>
<div class="line">            || ( ( z == 0 ) &amp;&amp; ( y == m ) )</div>
<div class="line">            || ( ( z == m ) &amp;&amp; ( y == m ) );</div>
<div class="line">          complex.insertCell( S.back(), </div>
<div class="line">                              fixed ? CC::FIXED </div>
<div class="line">                              : (<a name="a9"></a><a class="code" href="namespaceDGtal.html#a27c59126488e9c545120667959d2fc4e">DGtal::uint32_t</a>) floor(64.0 * n1 ) <span class="comment">// This is the priority for collapse </span></div>
<div class="line">                              );</div>
<div class="line">        }</div>
<div class="line">  <span class="comment">//complex.close();</span></div>
<div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a name="a10"></a><a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;After close: &quot;</span> &lt;&lt; complex &lt;&lt; std::endl;</div>
<div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a name="a11"></a><a class="code" href="classDGtal_1_1Trace.html#afa3a2874289734884107b1ce68ccb93d">endBlock</a>();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// for 3D display with Viewer3D</span></div>
<div class="line">  QApplication application(argc,argv);</div>
<div class="line">  <span class="keyword">typedef</span> <a name="_a12"></a><a class="code" href="classDGtal_1_1Viewer3D.html">Viewer3D&lt;Space, KSpace&gt;</a> <a class="code" href="classDGtal_1_1Viewer3D.html">MyViewer</a>;</div>
<div class="line"></div>
<div class="line">  {</div>
<div class="line">    MyViewer viewer(K);</div>
<div class="line">    viewer.show();</div>
<div class="line">    <span class="keyword">typedef</span> <a class="code" href="classDGtal_1_1CubicalComplex.html#ad81cf19b21560476a0c62f4f16abbb12">CC::CellMapConstIterator</a> CellMapConstIterator;</div>
<div class="line">    <span class="keywordflow">for</span> ( <a class="code" href="namespaceDGtal.html#a8fbe8c8d47ca5c36ced14284ac62613d">Dimension</a> d = 0; d &lt;= 3; ++d )</div>
<div class="line">      <span class="keywordflow">for</span> ( CellMapConstIterator it = complex.begin( d ), itE = complex.end( d );</div>
<div class="line">            it != itE; ++it )</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordtype">bool</span> fixed = (it-&gt;second.data == CC::FIXED);</div>
<div class="line">          <span class="keywordflow">if</span> ( fixed ) viewer.setFillColor( Color::Red );</div>
<div class="line">          <span class="keywordflow">else</span>         viewer.setFillColor( Color::White );</div>
<div class="line">          viewer &lt;&lt; it-&gt;first;</div>
<div class="line">        }</div>
<div class="line">    viewer&lt;&lt; <a name="a13"></a><a class="code" href="classDGtal_1_1Display3D.html#a96b45e0a0c762c14c0e5e27045d1ca04a96910329360ab83c484f03e0fff1cb45">MyViewer::updateDisplay</a>;</div>
<div class="line">    application.exec();</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#a352b7160bf722e2f0bcbee5d0bad6ef3">beginBlock</a>( <span class="stringliteral">&quot;Collapsing complex&quot;</span> );</div>
<div class="line">  <a name="_a14"></a><a class="code" href="structDGtal_1_1CubicalComplex_1_1DefaultCellMapIteratorPriority.html">CC::DefaultCellMapIteratorPriority</a> P;</div>
<div class="line">  <a class="code" href="namespaceDGtal.html#ab33c0c25b8cc3cd86de343bca34329f5">DGtal::uint64_t</a> removed </div>
<div class="line">    = functions::collapse( complex, S.begin(), S.end(), P, <span class="keyword">true</span>, <span class="keyword">true</span>, true );</div>
<div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;Collapse removed &quot;</span> &lt;&lt; removed &lt;&lt; <span class="stringliteral">&quot; cells.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;After collapse: &quot;</span> &lt;&lt; complex &lt;&lt; std::endl;</div>
<div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#afa3a2874289734884107b1ce68ccb93d">endBlock</a>();</div>
<div class="line"></div>
<div class="line">  {</div>
<div class="line">    MyViewer viewer(K);</div>
<div class="line">    viewer.show();</div>
<div class="line">    <span class="keyword">typedef</span> <a class="code" href="classDGtal_1_1CubicalComplex.html#ad81cf19b21560476a0c62f4f16abbb12">CC::CellMapConstIterator</a> CellMapConstIterator;</div>
<div class="line">    <span class="keywordflow">for</span> ( <a class="code" href="namespaceDGtal.html#a8fbe8c8d47ca5c36ced14284ac62613d">Dimension</a> d = 0; d &lt;= 3; ++d )</div>
<div class="line">      <span class="keywordflow">for</span> ( CellMapConstIterator it = complex.begin( d ), itE = complex.end( d );</div>
<div class="line">            it != itE; ++it )</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordtype">bool</span> fixed = (it-&gt;second.data == CC::FIXED);</div>
<div class="line">          <span class="keywordflow">if</span> ( fixed ) viewer.setFillColor( Color::Red );</div>
<div class="line">          <span class="keywordflow">else</span>         viewer.setFillColor( Color::White );</div>
<div class="line">          viewer &lt;&lt; it-&gt;first;</div>
<div class="line">        }</div>
<div class="line">    viewer&lt;&lt; <a class="code" href="classDGtal_1_1Display3D.html#a96b45e0a0c762c14c0e5e27045d1ca04a96910329360ab83c484f03e0fff1cb45">MyViewer::updateDisplay</a>;</div>
<div class="line">    <span class="keywordflow">return</span> application.exec();</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jun 27 2016 09:38:05 for DGtal by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
