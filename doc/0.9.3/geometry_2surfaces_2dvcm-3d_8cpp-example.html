<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DGtal: geometry/surfaces/dvcm-3d.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="modern-doxygen-blue.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DGtal
   &#160;<span id="projectnumber">0.9.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">geometry/surfaces/dvcm-3d.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>This example shows the computation of the VCM of a digital surface read from a .vol file. The normal is estimated from the diagonalization of the VCM tensor, while the orientation is deduced from the orientation of the trivial surfel normals. Feature detection is achieved with the eigenvalues of the VCM. A red color indicates a feature. Normals are displayed as black lines.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="moduleVCM.html#moduleVCM_sec3">Voronoi Covariance Measure of a digital surface</a></dd></dl>
<pre class="fragment">$ ./examples/geometry/surfaces/dvcm-3d
</pre><div class="image">
<img src="dvcm-3d-hat-r.png" alt="dvcm-3d-hat-r.png"/>
<div class="caption">
Normal vector and feature detection with Voronoi Covariance Measure.</div></div>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;DGtal/base/Common.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/helpers/StdDefs.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/kernel/BasicPointPredicates.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/math/linalg/EigenDecomposition.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/topology/helpers/Surfaces.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/topology/DigitalSurface.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/topology/ImplicitDigitalSurface.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/images/ImageSelector.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/images/IntervalForegroundPredicate.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/geometry/volumes/distance/ExactPredicateLpSeparableMetric.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/geometry/surfaces/estimation/VoronoiCovarianceMeasureOnDigitalSurface.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/io/colormaps/GradientColorMap.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/io/viewers/Viewer3D.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/io/readers/GenericReader.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;ConfigExamples.h&quot;</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceDGtal.html">DGtal</a>;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a name="a0"></a><a class="code" href="testArithmeticDSS-benchmark_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv )</div><div class="line">{</div><div class="line">  QApplication application(argc,argv);</div><div class="line"></div><div class="line">  <span class="keyword">typedef</span> <a name="_a1"></a><a class="code" href="classDGtal_1_1SpaceND.html">Z3i::Space</a> <a name="a2"></a><a class="code" href="testSimpleRandomAccessRangeFromPoint_8cpp.html#a38dfaf1641eab4d3fb805df4b52ab10d">Space</a>;</div><div class="line">  <span class="keyword">typedef</span> <a name="_a3"></a><a class="code" href="classDGtal_1_1KhalimskySpaceND.html">Z3i::KSpace</a> <a class="code" href="namespaceDGtal_1_1Z2i.html#a6183d00ec6f8c4f81748fd20a52e5590">KSpace</a>;</div><div class="line">  <span class="keyword">typedef</span> <a name="_a4"></a><a class="code" href="classDGtal_1_1PointVector.html">Z3i::Point</a> <a name="a5"></a><a class="code" href="testClone2_8cpp.html#a15e9592ccc512dc691b46185e6814758">Point</a>;</div><div class="line">  <span class="keyword">typedef</span> <a name="_a6"></a><a class="code" href="classDGtal_1_1PointVector.html">Z3i::RealPoint</a> <a class="code" href="namespaceDGtal_1_1Z2i.html#a858b8746eb7dc0280c8e12b37e56d9e3">RealPoint</a>;</div><div class="line">  <span class="keyword">typedef</span> <a class="code" href="classDGtal_1_1PointVector.html">Z3i::RealVector</a> <a class="code" href="namespaceDGtal_1_1Z2i.html#a0db3f1b80b0d65707785c1072244befc">RealVector</a>;</div><div class="line">  <span class="keyword">typedef</span> <a name="_a7"></a><a class="code" href="classDGtal_1_1HyperRectDomain.html">HyperRectDomain&lt;Space&gt;</a> <a name="a8"></a><a class="code" href="testSimpleRandomAccessRangeFromPoint_8cpp.html#acd532b318489cd93df57e0b3d136d050">Domain</a>;</div><div class="line">  <span class="keyword">typedef</span> KSpace::Surfel Surfel;</div><div class="line">  <span class="keyword">typedef</span> <a name="a9"></a><a class="code" href="testCubicalComplex_8cpp.html#a9b10591d95c90247f1c7b3bd52853782">KSpace::Cell</a> <a class="code" href="testCubicalComplex_8cpp.html#a9b10591d95c90247f1c7b3bd52853782">Cell</a>;</div><div class="line"></div><div class="line">  <span class="keyword">typedef</span> <a name="_a10"></a><a class="code" href="structDGtal_1_1ImageSelector.html">ImageSelector&lt;Domain, unsigned char&gt;::Type</a> <a name="a11"></a><a class="code" href="testSimpleRandomAccessRangeFromPoint_8cpp.html#a852ab282e5168b5711ef7a87b3aefa68">Image</a>;</div><div class="line">  <span class="keyword">typedef</span> <a name="_a12"></a><a class="code" href="classDGtal_1_1functors_1_1IntervalForegroundPredicate.html">functors::IntervalForegroundPredicate&lt;Image&gt;</a> ThresholdedImage;</div><div class="line">  <span class="keyword">typedef</span> <a name="_a13"></a><a class="code" href="classDGtal_1_1ImplicitDigitalSurface.html">ImplicitDigitalSurface&lt; KSpace, ThresholdedImage &gt;</a> DigitalSurfaceContainer;</div><div class="line"></div><div class="line">  <span class="keyword">typedef</span> <a name="_a14"></a><a class="code" href="classDGtal_1_1ExactPredicateLpSeparableMetric.html">ExactPredicateLpSeparableMetric&lt;Space, 2&gt;</a> Metric;          <span class="comment">// L2-metric type</span></div><div class="line">  <span class="keyword">typedef</span> <a name="_a15"></a><a class="code" href="structDGtal_1_1functors_1_1HatPointFunction.html">functors::HatPointFunction&lt;Point,double&gt;</a>  KernelFunction;  <span class="comment">// chi function type</span></div><div class="line">  <span class="keyword">typedef</span> <a name="_a16"></a><a class="code" href="classDGtal_1_1VoronoiCovarianceMeasureOnDigitalSurface.html">VoronoiCovarianceMeasureOnDigitalSurface</a>&lt; DigitalSurfaceContainer, Metric,</div><div class="line">                                                    KernelFunction &gt; VCMOnSurface;</div><div class="line">  <span class="keyword">typedef</span> VCMOnSurface::Surfel2Normals::const_iterator S2NConstIterator;</div><div class="line"></div><div class="line">  <span class="keywordtype">string</span> inputFilename = examplesPath + <span class="stringliteral">&quot;samples/Al.100.vol&quot;</span>;</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a name="a17"></a><a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;File             = &quot;</span> &lt;&lt; inputFilename &lt;&lt; std::endl;</div><div class="line">  <span class="keywordtype">int</span> thresholdMin = 0;</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;Min image thres. = &quot;</span> &lt;&lt; thresholdMin &lt;&lt; std::endl;</div><div class="line">  <span class="keywordtype">int</span> thresholdMax = 1;</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;Max image thres. = &quot;</span> &lt;&lt; thresholdMax &lt;&lt; std::endl;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> R = 20;</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;Big radius     R = &quot;</span> &lt;&lt; R &lt;&lt; std::endl;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> r = 3;</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;Small radius   r = &quot;</span> &lt;&lt; r &lt;&lt; std::endl;</div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> trivial_r = 3;</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;Trivial radius t = &quot;</span> &lt;&lt; trivial_r &lt;&lt; std::endl; <span class="comment">// for orienting the directions given by the tensor.</span></div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> T = 0.1;</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;Feature thres. T = &quot;</span> &lt;&lt; T &lt;&lt; std::endl; <span class="comment">// threshold for displaying features as red.</span></div><div class="line"></div><div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> size = 1.0; <span class="comment">// size of displayed normals.</span></div><div class="line"></div><div class="line">  KSpace ks;</div><div class="line">  <span class="comment">// Reads the volume</span></div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a name="a18"></a><a class="code" href="classDGtal_1_1Trace.html#a352b7160bf722e2f0bcbee5d0bad6ef3">beginBlock</a>( <span class="stringliteral">&quot;Loading image into memory and build digital surface.&quot;</span> );</div><div class="line">  Image image = <a name="_a19"></a><a class="code" href="structDGtal_1_1GenericReader.html">GenericReader&lt;Image&gt;::import</a>(inputFilename );</div><div class="line">  ThresholdedImage thresholdedImage( image, thresholdMin, thresholdMax );</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a name="a20"></a><a class="code" href="classDGtal_1_1Trace.html#afa3a2874289734884107b1ce68ccb93d">endBlock</a>();</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#a352b7160bf722e2f0bcbee5d0bad6ef3">beginBlock</a>( <span class="stringliteral">&quot;Extracting boundary by scanning the space. &quot;</span> );</div><div class="line">  ks.init( image.<a name="a21"></a><a class="code" href="classDGtal_1_1Image.html#a40c7316b7ddd1f6e927194c35196d77c">domain</a>().lowerBound(),</div><div class="line">                           image.<a class="code" href="classDGtal_1_1Image.html#a40c7316b7ddd1f6e927194c35196d77c">domain</a>().upperBound(), true );</div><div class="line">  <a name="_a22"></a><a class="code" href="classDGtal_1_1SurfelAdjacency.html">SurfelAdjacency&lt;KSpace::dimension&gt;</a> surfAdj( <span class="keyword">true</span> ); <span class="comment">// interior in all directions.</span></div><div class="line">  Surfel bel = <a name="_a23"></a><a class="code" href="classDGtal_1_1Surfaces.html">Surfaces&lt;KSpace&gt;::findABel</a>( ks, thresholdedImage, 10000 );</div><div class="line">  DigitalSurfaceContainer* container =</div><div class="line">    <span class="keyword">new</span> DigitalSurfaceContainer( ks, thresholdedImage, surfAdj, bel, <span class="keyword">false</span>  );</div><div class="line">  <a name="_a24"></a><a class="code" href="classDGtal_1_1DigitalSurface.html">DigitalSurface&lt; DigitalSurfaceContainer &gt;</a> surface( container ); <span class="comment">//acquired</span></div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;Digital surface has &quot;</span> &lt;&lt; surface.<a name="a25"></a><a class="code" href="classDGtal_1_1DigitalSurface.html#a9590c589a5e106068c3d34658fe8e34b">size</a>() &lt;&lt; <span class="stringliteral">&quot; surfels.&quot;</span> &lt;&lt; std::endl;</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#afa3a2874289734884107b1ce68ccb93d">endBlock</a>();</div><div class="line"></div><div class="line">  <a class="code" href="namespaceDGtal.html#aaad242ffef715835e8928579a506b2d5">Surfel2PointEmbedding</a> embType = <a class="code" href="namespaceDGtal.html#aaad242ffef715835e8928579a506b2d5ac0a8bc5774ff6530ee71a7cacd6ca6f4">Pointels</a>; <span class="comment">// Could be Pointels|InnerSpel|OuterSpel;</span></div><div class="line">  Metric l2;                                <span class="comment">// Euclidean L2 metric</span></div><div class="line">  KernelFunction chi( 1.0, r );             <span class="comment">// hat function with support of radius r</span></div><div class="line">  VCMOnSurface vcm_surface( surface, embType, R, r,</div><div class="line">                            chi, trivial_r, l2, <span class="keyword">true</span> <span class="comment">/* verbose */</span> );</div><div class="line"></div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#a352b7160bf722e2f0bcbee5d0bad6ef3">beginBlock</a>( <span class="stringliteral">&quot;Displaying VCM&quot;</span> );</div><div class="line">  <a name="_a26"></a><a class="code" href="classDGtal_1_1Viewer3D.html">Viewer3D&lt;&gt;</a> viewer( ks );</div><div class="line">  Cell dummy;</div><div class="line">  viewer.setWindowTitle(<span class="stringliteral">&quot;3D VCM viewer&quot;</span>);</div><div class="line">  viewer &lt;&lt; <a name="_a27"></a><a class="code" href="structDGtal_1_1SetMode3D.html">SetMode3D</a>( dummy.className(), <span class="stringliteral">&quot;Basic&quot;</span> );</div><div class="line">  viewer.<a name="a28"></a><a class="code" href="classDGtal_1_1Viewer3D.html#a6113d9e02bdce9ed7b97a71abc21a1e1">show</a>();</div><div class="line"></div><div class="line">  <a name="_a29"></a><a class="code" href="classDGtal_1_1GradientColorMap.html">GradientColorMap&lt;double&gt;</a> grad( 0, T );</div><div class="line">  grad.<a name="a30"></a><a class="code" href="classDGtal_1_1GradientColorMap.html#a0d40c7b3643e533b2357ce908ae1f08c">addColor</a>( <a name="_a31"></a><a class="code" href="classDGtal_1_1Color.html">Color</a>( 128, 128, 255 ) );</div><div class="line">  grad.<a class="code" href="classDGtal_1_1GradientColorMap.html#a0d40c7b3643e533b2357ce908ae1f08c">addColor</a>( <a class="code" href="classDGtal_1_1Color.html">Color</a>( 255, 255, 255 ) );</div><div class="line">  grad.<a class="code" href="classDGtal_1_1GradientColorMap.html#a0d40c7b3643e533b2357ce908ae1f08c">addColor</a>( <a class="code" href="classDGtal_1_1Color.html">Color</a>( 255, 255, 0 ) );</div><div class="line">  grad.<a class="code" href="classDGtal_1_1GradientColorMap.html#a0d40c7b3643e533b2357ce908ae1f08c">addColor</a>( <a class="code" href="classDGtal_1_1Color.html">Color</a>( 255, 0, 0 ) );</div><div class="line">  RealVector lambda; <span class="comment">// eigenvalues of chi-vcm</span></div><div class="line">  <span class="keywordflow">for</span> ( S2NConstIterator it = vcm_surface.mapSurfel2Normals().begin(),</div><div class="line">          itE = vcm_surface.mapSurfel2Normals().end(); it != itE; ++it )</div><div class="line">    {</div><div class="line">      Surfel s = it-&gt;first;</div><div class="line">      Point kp = ks.sKCoords( s );</div><div class="line">      RealPoint rp( 0.5 * (<span class="keywordtype">double</span>) kp[ 0 ], 0.5 * (<span class="keywordtype">double</span>) kp[ 1 ], 0.5 * (<span class="keywordtype">double</span>) kp[ 2 ] );</div><div class="line">      RealVector n = it-&gt;second.vcmNormal;</div><div class="line">      vcm_surface.getChiVCMEigenvalues( lambda, s );</div><div class="line">      <span class="keywordtype">double</span> ratio = lambda[ 1 ] / ( lambda[ 0 ] + lambda[ 1 ] + lambda[ 2 ] );</div><div class="line">      viewer.<a name="a32"></a><a class="code" href="classDGtal_1_1Display3D.html#a6d3b9f4ae1c72221fbab19206c53af23">setFillColor</a>( grad( ratio &gt; T ? T : ratio ) );</div><div class="line">      viewer &lt;&lt; ks.unsigns( s );</div><div class="line">      n *= size;</div><div class="line">      viewer.<a name="a33"></a><a class="code" href="classDGtal_1_1Display3D.html#a24e96f9ff46a82b5b99ab9ab164788b9">setLineColor</a>( Color::Black );</div><div class="line">      viewer.<a name="a34"></a><a class="code" href="classDGtal_1_1Display3D.html#a80ee4578cb9de2323c7c51c6c05295f5">addLine</a>( rp + n, rp - n, 0.1 );</div><div class="line">     }</div><div class="line">  viewer &lt;&lt; Viewer3D&lt;&gt;::updateDisplay;</div><div class="line">  application.exec();</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#afa3a2874289734884107b1ce68ccb93d">endBlock</a>();</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"><span class="comment">//                                                                           //</span></div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Feb 12 2017 10:24:42 for DGtal by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
