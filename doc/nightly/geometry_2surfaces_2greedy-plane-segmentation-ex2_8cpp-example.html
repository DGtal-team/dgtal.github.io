<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DGtal: geometry/surfaces/greedy-plane-segmentation-ex2.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="modern-doxygen-blue.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DGtal
   &#160;<span id="projectnumber">1.0.beta</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">geometry/surfaces/greedy-plane-segmentation-ex2.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>This example shows a not-so-greedy segmentation into naive planes of the surface at threshold 0 within volume Al.100.vol.</p>
<p>It enhances the polyhedrization of <a class="el" href="greedy-plane-segmentation_8cpp.html">greedy-plane-segmentation.cpp</a> by selecting first the vertices that induces the biggest planes. This is much slower than the other, but it gives nicer results. For each vertex, it computes its best plane by breadth-first traversal. It stores the obtained size for each vertex independently. It puts them in a priority queue, the first to be popped are the ones with the biggest size. The remaining of the algorithm is unchanged.</p>
<p>Colors for each plane are chosen randomly. Surfels in the same plane have the same color.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="moduleCOBANaivePlaneRecognition.html#moduleCOBANaivePlaneRecognition_sec5">Application to greedy segmentation into digital planes</a> (solution of exercice 2)</dd></dl>
<pre class="fragment"># naive plane: width=1/1
$ ./examples/geometry/surfaces/greedy-plane-segmentation-ex2 -i ./examples/samples/Al.100.vol -t 0 -w 1 -d 1
</pre><div class="image">
<img src="greedy-plane-segmentation-ex2-al-w1.png" alt="greedy-plane-segmentation-ex2-al-w1.png"/>
<div class="caption">
Not-so-greedy segmentation of Al capone into naive planes.</div></div>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;set&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;queue&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/base/Common.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/io/readers/VolReader.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;DGtal/io/Display3D.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/io/viewers/Viewer3D.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/io/DrawWithDisplay3DModifier.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/images/ImageSelector.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/images/imagesSetsUtils/SetFromImage.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/topology/DigitalSurface.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/topology/DigitalSetBoundary.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/graph/BreadthFirstVisitor.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/geometry/surfaces/COBANaivePlaneComputer.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;DGtal/helpers/StdDefs.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;ConfigExamples.h&quot;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceDGtal.html">DGtal</a>;</div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceZ3i.html">Z3i</a>;</div><div class="line"><span class="keyword">typedef</span> <a class="code" href="namespaceDGtal.html#a1c09e3f63904ff371f1b99f45069fc63">DGtal::int64_t</a> <a name="a0"></a><a class="code" href="greedy-plane-segmentation-ex2_8cpp.html#aec66eb43935379dd86245097a9c70bac">InternalInteger</a>;</div><div class="line"><span class="keyword">typedef</span> <a name="_a1"></a><a class="code" href="classDGtal_1_1COBANaivePlaneComputer.html">COBANaivePlaneComputer&lt;Z3,InternalInteger&gt;</a> <a name="a2"></a><a class="code" href="greedy-plane-segmentation-ex2_8cpp.html#a56a9dd4ad526e12927cd7ccea682d244">NaivePlaneComputer</a>;</div><div class="line"><span class="comment">// We choose the DigitalSetBoundary surface container in order to</span></div><div class="line"><span class="comment">// segment connected or unconnected surfaces.</span></div><div class="line"><span class="keyword">typedef</span> <a name="_a3"></a><a class="code" href="classDGtal_1_1DigitalSetBoundary.html">DigitalSetBoundary&lt;KSpace,DigitalSet&gt;</a> <a name="a4"></a><a class="code" href="greedy-plane-segmentation-ex2_8cpp.html#ac9ee7087e3a195e77c3d27a1b002d6d6">MyDigitalSurfaceContainer</a>;</div><div class="line"><span class="keyword">typedef</span> <a name="_a5"></a><a class="code" href="classDGtal_1_1DigitalSurface.html">DigitalSurface&lt;MyDigitalSurfaceContainer&gt;</a> <a name="a6"></a><a class="code" href="greedy-plane-segmentation-ex2_8cpp.html#a03d731f44ed1110acdbefdc2357f84cf">MyDigitalSurface</a>;</div><div class="line"><span class="keyword">typedef</span> <a class="code" href="classDGtal_1_1DigitalSurface.html#a40056dd099c93e7ab5dfc5196a56e550">MyDigitalSurface::ConstIterator</a> <a name="a7"></a><a class="code" href="greedy-plane-segmentation-ex2_8cpp.html#a6d06fad433cff067dfcbbbf16d6e2dbf">ConstIterator</a>;</div><div class="line"><span class="keyword">typedef</span> <a class="code" href="classDGtal_1_1DigitalSurface.html#a637f8034aff12a2f65fe9cc47c95b8db">MyDigitalSurface::Vertex</a> <a name="a8"></a><a class="code" href="testTriangulatedSurface_8cpp.html#ae931baebcf0de56dd5f3b9342207e4fd">Vertex</a>;</div><div class="line"><span class="keyword">typedef</span> <a class="code" href="classDGtal_1_1DigitalSurface.html#aaa80abbd219d17cd225cc8f961be68f2">MyDigitalSurface::SurfelSet</a> <a name="a9"></a><a class="code" href="greedy-plane-segmentation-ex2_8cpp.html#a9e248ca0929052a040e6dfa7018611c2">SurfelSet</a>;</div><div class="line"><span class="keyword">typedef</span> SurfelSet::iterator <a name="a10"></a><a class="code" href="greedy-plane-segmentation-ex2_8cpp.html#a25cdaf11e42c0d24f9f7aa870f50e2e1">SurfelSetIterator</a>;</div><div class="line"><span class="keyword">typedef</span> <a name="_a11"></a><a class="code" href="classDGtal_1_1BreadthFirstVisitor.html">BreadthFirstVisitor&lt;MyDigitalSurface&gt;</a> <a name="a12"></a><a class="code" href="greedy-plane-segmentation-ex2_8cpp.html#ac49b0cfbe4d1466bd0b6ab2a3b2f703b">Visitor</a>;</div><div class="line"><span class="keyword">struct </span>SegmentedPlane {</div><div class="line">  <a class="code" href="classDGtal_1_1COBANaivePlaneComputer.html">NaivePlaneComputer</a> plane;</div><div class="line">  <a name="_a13"></a><a class="code" href="classDGtal_1_1Color.html">Color</a> color;</div><div class="line">};</div><div class="line"><span class="keyword">struct </span>VertexSize {</div><div class="line">  <a class="code" href="testTriangulatedSurface_8cpp.html#ae931baebcf0de56dd5f3b9342207e4fd">Vertex</a> v;</div><div class="line">  std::size_t size;</div><div class="line">  <span class="keyword">inline</span> VertexSize( <span class="keyword">const</span> <a class="code" href="testTriangulatedSurface_8cpp.html#ae931baebcf0de56dd5f3b9342207e4fd">Vertex</a> &amp; aV, std::size_t aSize )</div><div class="line">    : v( aV ), size( aSize )</div><div class="line">  {}</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">inline</span></div><div class="line"><span class="keywordtype">bool</span> <a name="a14"></a><a class="code" href="greedy-plane-segmentation-ex2_8cpp.html#a155251f99b7494212edc07a04a80a3b8">operator&lt;</a>( <span class="keyword">const</span> VertexSize &amp; vs1, <span class="keyword">const</span> VertexSize &amp; vs2 )</div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> vs1.size &lt; vs2.size;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a name="a15"></a><a class="code" href="testArithmeticDSS-benchmark_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv )</div><div class="line">{</div><div class="line">   <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a name="a16"></a><a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;Segments the surface at given threshold within given volume into digital planes of rational width num/den.&quot;</span> &lt;&lt; std::endl;</div><div class="line">  <span class="comment">// Setting default options: ----------------------------------------------</span></div><div class="line">  <span class="comment">// input file used:</span></div><div class="line">   <span class="keywordtype">string</span> inputFilename =   examplesPath + <span class="stringliteral">&quot;samples/Al.100.vol&quot;</span> ;</div><div class="line">    <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;input file used &quot;</span> &lt;&lt; inputFilename &lt;&lt; std::endl;</div><div class="line">  <span class="comment">// parameter threshold</span></div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> threshold = 0;</div><div class="line">    <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;the value that defines the isosurface in the image (an integer between 0 and 255)= &quot;</span> &lt;&lt; threshold&lt;&lt; std::endl;</div><div class="line">   <span class="comment">// parameter widthNum</span></div><div class="line">   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> widthNum = 1;</div><div class="line">   <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;the numerator of the rational width (a non-null integer) =&quot;</span> &lt;&lt; widthNum&lt;&lt; std::endl;</div><div class="line">   <span class="comment">// parameter widthDen</span></div><div class="line">   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> widthDen = 1;</div><div class="line">   <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad054990834d2763627166540087a2980">info</a>() &lt;&lt; <span class="stringliteral">&quot;the denominator of the rational width (a non-null integer)= &quot;</span> &lt;&lt; widthDen&lt;&lt; std::endl;</div><div class="line"></div><div class="line">  QApplication application(argc,argv);</div><div class="line">  <span class="keyword">typedef</span> <a name="_a17"></a><a class="code" href="classDGtal_1_1ImageContainerBySTLVector.html">ImageSelector &lt; Domain, int&gt;::Type</a> <a name="a18"></a><a class="code" href="testSimpleRandomAccessRangeFromPoint_8cpp.html#a852ab282e5168b5711ef7a87b3aefa68">Image</a>;</div><div class="line">  <a name="_a19"></a><a class="code" href="classDGtal_1_1Image.html">Image</a> image = <a name="_a20"></a><a class="code" href="structDGtal_1_1VolReader.html">VolReader&lt;Image&gt;::importVol</a>(inputFilename);</div><div class="line">  <a class="code" href="namespaceDGtal_1_1Z2i.html#a371252c324e496cf8650757c1a2b4eb0">DigitalSet</a> set3d (image.domain());</div><div class="line">  <a name="_a21"></a><a class="code" href="structDGtal_1_1SetFromImage.html">SetFromImage&lt;DigitalSet&gt;::append</a>&lt;<a class="code" href="classDGtal_1_1Image.html">Image</a>&gt;(set3d, <a name="a22"></a><a class="code" href="testSimpleRandomAccessRangeFromPoint_8cpp.html#a614d1b1c043b31763c1eb50f64666737">image</a>, threshold,255);</div><div class="line"></div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a name="a23"></a><a class="code" href="classDGtal_1_1Trace.html#a352b7160bf722e2f0bcbee5d0bad6ef3">beginBlock</a>( <span class="stringliteral">&quot;Set up digital surface.&quot;</span> );</div><div class="line">  <span class="comment">// We initializes the cellular grid space used for defining the</span></div><div class="line">  <span class="comment">// digital surface.</span></div><div class="line">  <a name="_a24"></a><a class="code" href="classDGtal_1_1KhalimskySpaceND.html">KSpace</a> ks;</div><div class="line">  <span class="keywordtype">bool</span> ok = ks.<a name="a25"></a><a class="code" href="classDGtal_1_1KhalimskySpaceND.html#a15dcbcaae831dd1c36090e6336c177d4">init</a>( set3d.domain().lowerBound(),</div><div class="line">                     set3d.domain().upperBound(), true );</div><div class="line">  <span class="keywordflow">if</span> ( ! ok ) std::cerr &lt;&lt; <span class="stringliteral">&quot;[KSpace.init] Failed.&quot;</span> &lt;&lt; std::endl;</div><div class="line">  <a name="_a26"></a><a class="code" href="classDGtal_1_1SurfelAdjacency.html">SurfelAdjacency&lt;KSpace::dimension&gt;</a> surfAdj( <span class="keyword">true</span> ); <span class="comment">// interior in all directions.</span></div><div class="line">  <a class="code" href="classDGtal_1_1DigitalSetBoundary.html">MyDigitalSurfaceContainer</a>* ptrSurfContainer =</div><div class="line">    <span class="keyword">new</span> <a class="code" href="greedy-plane-segmentation-ex2_8cpp.html#ac9ee7087e3a195e77c3d27a1b002d6d6">MyDigitalSurfaceContainer</a>( ks, set3d, surfAdj );</div><div class="line">  <a class="code" href="classDGtal_1_1DigitalSurface.html">MyDigitalSurface</a> digSurf( ptrSurfContainer ); <span class="comment">// acquired</span></div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a name="a27"></a><a class="code" href="classDGtal_1_1Trace.html#afa3a2874289734884107b1ce68ccb93d">endBlock</a>();</div><div class="line"></div><div class="line">  <a class="code" href="testClone2_8cpp.html#a15e9592ccc512dc691b46185e6814758">Point</a> p;</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fbe8c8d47ca5c36ced14284ac62613d">Dimension</a> axis;</div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0;</div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nb = digSurf.size();</div><div class="line"></div><div class="line">  <span class="comment">// First pass to find biggest planes.</span></div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#a352b7160bf722e2f0bcbee5d0bad6ef3">beginBlock</a>( <span class="stringliteral">&quot;1) Segmentation first pass. Computes all planes so as to sort vertices by the plane size.&quot;</span> );</div><div class="line">  std::map&lt;Vertex,unsigned int&gt; v2size;</div><div class="line">  <a class="code" href="classDGtal_1_1COBANaivePlaneComputer.html">NaivePlaneComputer</a> planeComputer;</div><div class="line">  std::priority_queue&lt;VertexSize&gt; Q;</div><div class="line">  <span class="keywordflow">for</span> ( <a class="code" href="greedy-plane-segmentation-ex2_8cpp.html#a6d06fad433cff067dfcbbbf16d6e2dbf">ConstIterator</a> it = digSurf.begin(), itE= digSurf.end(); it != itE; ++it )</div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> ( ( (++j) % 50 == 0 ) || ( j == nb ) ) <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a name="a28"></a><a class="code" href="classDGtal_1_1Trace.html#ad8efd553b31277903be115e7aa256f74">progressBar</a>( j, nb );</div><div class="line">      <a class="code" href="testTriangulatedSurface_8cpp.html#ae931baebcf0de56dd5f3b9342207e4fd">Vertex</a> v = *it;</div><div class="line">      axis = ks.<a name="a29"></a><a class="code" href="classDGtal_1_1KhalimskySpaceND.html#a1e9033f0d1b60cd23fbfb96c19ee5ab1">sOrthDir</a>( v );</div><div class="line">      planeComputer.<a name="a30"></a><a class="code" href="classDGtal_1_1COBANaivePlaneComputer.html#a17098fa05c7e9cf548d69283410c10e2">init</a>( axis, 500, widthNum, widthDen );</div><div class="line">      <span class="comment">// The visitor takes care of all the breadth-first traversal.</span></div><div class="line">      <a class="code" href="classDGtal_1_1BreadthFirstVisitor.html">Visitor</a> visitor( digSurf, v );</div><div class="line">      <span class="keywordflow">while</span> ( ! visitor.finished() )</div><div class="line">        {</div><div class="line">          <a class="code" href="classDGtal_1_1BreadthFirstVisitor.html#ad66e84867d0eb0c092900af4df0ae026">Visitor::Node</a> node = visitor.current();</div><div class="line">          v = node.first;</div><div class="line">          axis = ks.<a class="code" href="classDGtal_1_1KhalimskySpaceND.html#a1e9033f0d1b60cd23fbfb96c19ee5ab1">sOrthDir</a>( v );</div><div class="line">          p = ks.<a name="a31"></a><a class="code" href="classDGtal_1_1KhalimskySpaceND.html#a36d05bc463af9b7521723edfee606315">sCoords</a>( ks.<a name="a32"></a><a class="code" href="classDGtal_1_1KhalimskySpaceND.html#aaa60ad137a7aa68627cd86b0d76c3693">sDirectIncident</a>( v, axis ) );</div><div class="line">          <span class="keywordtype">bool</span> isExtended = planeComputer.<a name="a33"></a><a class="code" href="classDGtal_1_1COBANaivePlaneComputer.html#af2772a864766a21ee7ab9538c6c8d66e">extend</a>( p );</div><div class="line">          <span class="keywordflow">if</span> ( isExtended )</div><div class="line">            <span class="comment">// surfel is in plane.</span></div><div class="line">            visitor.expand();</div><div class="line">          <span class="keywordflow">else</span> <span class="comment">// surfel is not in plane and should not be used in the visit.</span></div><div class="line">            visitor.ignore();</div><div class="line">        }</div><div class="line">      Q.push( VertexSize( v, planeComputer.<a name="a34"></a><a class="code" href="classDGtal_1_1COBANaivePlaneComputer.html#a44bf18ccc0c12c4cebf4959ce8a8ee08">size</a>() ) );</div><div class="line">    }</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#afa3a2874289734884107b1ce68ccb93d">endBlock</a>();</div><div class="line"></div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#a352b7160bf722e2f0bcbee5d0bad6ef3">beginBlock</a>( <span class="stringliteral">&quot;2) Segmentation second pass. Visits vertices from the one with biggest plane to the one with smallest plane.&quot;</span> );</div><div class="line">  std::set&lt;Vertex&gt; processedVertices;</div><div class="line">  std::vector&lt;SegmentedPlane*&gt; segmentedPlanes;</div><div class="line">  std::map&lt;Vertex,SegmentedPlane*&gt; v2plane;</div><div class="line">  j = 0;</div><div class="line">  <span class="keywordflow">while</span> ( ! Q.empty() )</div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> ( ( (++j) % 50 == 0 ) || ( j == nb ) ) <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#ad8efd553b31277903be115e7aa256f74">progressBar</a>( j, nb );</div><div class="line">      <a class="code" href="testTriangulatedSurface_8cpp.html#ae931baebcf0de56dd5f3b9342207e4fd">Vertex</a> v = Q.top().v;</div><div class="line">      Q.pop();</div><div class="line">      <span class="keywordflow">if</span> ( processedVertices.find( v ) != processedVertices.end() ) <span class="comment">// already in set</span></div><div class="line">        <span class="keywordflow">continue</span>; <span class="comment">// process to next vertex</span></div><div class="line"></div><div class="line">      SegmentedPlane* ptrSegment = <span class="keyword">new</span> SegmentedPlane;</div><div class="line">      segmentedPlanes.push_back( ptrSegment ); <span class="comment">// to delete them afterwards.</span></div><div class="line">      axis = ks.<a class="code" href="classDGtal_1_1KhalimskySpaceND.html#a1e9033f0d1b60cd23fbfb96c19ee5ab1">sOrthDir</a>( v );</div><div class="line">      ptrSegment-&gt;plane.init( axis, 500, widthNum, widthDen );</div><div class="line">      <span class="comment">// The visitor takes care of all the breadth-first traversal.</span></div><div class="line">      <a class="code" href="classDGtal_1_1BreadthFirstVisitor.html">Visitor</a> visitor( digSurf, v );</div><div class="line">      <span class="keywordflow">while</span> ( ! visitor.finished() )</div><div class="line">        {</div><div class="line">          <a class="code" href="classDGtal_1_1BreadthFirstVisitor.html#ad66e84867d0eb0c092900af4df0ae026">Visitor::Node</a> node = visitor.current();</div><div class="line">          v = node.first;</div><div class="line">          <span class="keywordflow">if</span> ( processedVertices.find( v ) == processedVertices.end() )</div><div class="line">            { <span class="comment">// Vertex is not in processedVertices</span></div><div class="line">              axis = ks.<a class="code" href="classDGtal_1_1KhalimskySpaceND.html#a1e9033f0d1b60cd23fbfb96c19ee5ab1">sOrthDir</a>( v );</div><div class="line">              p = ks.<a class="code" href="classDGtal_1_1KhalimskySpaceND.html#a36d05bc463af9b7521723edfee606315">sCoords</a>( ks.<a class="code" href="classDGtal_1_1KhalimskySpaceND.html#aaa60ad137a7aa68627cd86b0d76c3693">sDirectIncident</a>( v, axis ) );</div><div class="line">              <span class="keywordtype">bool</span> isExtended = ptrSegment-&gt;plane.extend( p );</div><div class="line">              <span class="keywordflow">if</span> ( isExtended )</div><div class="line">                { <span class="comment">// surfel is in plane.</span></div><div class="line">                  processedVertices.insert( v );</div><div class="line">                  v2plane[ v ] = ptrSegment;</div><div class="line">                  visitor.expand();</div><div class="line">                }</div><div class="line">              <span class="keywordflow">else</span> <span class="comment">// surfel is not in plane and should not be used in the visit.</span></div><div class="line">                visitor.ignore();</div><div class="line">            }</div><div class="line">          <span class="keywordflow">else</span> <span class="comment">// surfel is already in some plane.</span></div><div class="line">            visitor.ignore();</div><div class="line">        }</div><div class="line">      <span class="comment">// Assign random color for each plane.</span></div><div class="line">      ptrSegment-&gt;color = <a class="code" href="classDGtal_1_1Color.html">Color</a>( rand() % 256, rand() % 256, rand() % 256, 255 );</div><div class="line">    }</div><div class="line">  <a class="code" href="namespaceDGtal.html#a8fc7012708b0416880a5c8b12dfdf9dd">trace</a>.<a class="code" href="classDGtal_1_1Trace.html#afa3a2874289734884107b1ce68ccb93d">endBlock</a>();</div><div class="line"></div><div class="line">  <a name="_a35"></a><a class="code" href="classDGtal_1_1Viewer3D.html">Viewer3D&lt;&gt;</a> viewer( ks );</div><div class="line">  viewer.show();</div><div class="line">  <span class="keywordflow">for</span> ( std::map&lt;Vertex,SegmentedPlane*&gt;::const_iterator</div><div class="line">          it = v2plane.begin(), itE = v2plane.end();</div><div class="line">        it != itE; ++it )</div><div class="line">    {</div><div class="line">      viewer &lt;&lt; <a name="_a36"></a><a class="code" href="structDGtal_1_1CustomColors3D.html">CustomColors3D</a>( it-&gt;second-&gt;color, it-&gt;second-&gt;color );</div><div class="line">      viewer &lt;&lt; ks.<a name="a37"></a><a class="code" href="classDGtal_1_1KhalimskySpaceND.html#a22d8a0b3bf9ab0c07596ff57af908f92">unsigns</a>( it-&gt;first );</div><div class="line">    }</div><div class="line">  viewer &lt;&lt; Viewer3D&lt;&gt;::updateDisplay;</div><div class="line"></div><div class="line">  <span class="keywordflow">for</span> ( std::vector&lt;SegmentedPlane*&gt;::iterator</div><div class="line">          it = segmentedPlanes.begin(), itE = segmentedPlanes.end();</div><div class="line">        it != itE; ++it )</div><div class="line">    <span class="keyword">delete</span> *it;</div><div class="line">  segmentedPlanes.clear();</div><div class="line">  v2plane.clear();</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> application.exec();</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Nov 30 2018 08:58:39 for DGtal by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
