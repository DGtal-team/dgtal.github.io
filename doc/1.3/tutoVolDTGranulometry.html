<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DGtal: Tutorial: Volumetric analysis and Granulometry</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="modern-doxygen-blue.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DGtal<span id="projectnumber">&#160;1.3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Tutorial: Volumetric analysis and Granulometry </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#tutosectIntroGranulo">Introduction</a></li>
<li class="level1"><a href="#VDTG_tutosectLoadVol">Import volumetric image an visualization</a></li>
<li class="level1"><a href="#tutosecDT">Distance Transformation</a></li>
<li class="level1"><a href="#tutosecShape">Granulometric function</a></li>
<li class="level1"><a href="#volDTSecCCL">Conclusion</a></li>
</ul>
</div>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>David Coeurjolly</dd></dl>
<p>The objective of this tutorial is to perform some elementary volumetric analysis of 3D objects. With this tutorial, you will experiment the following <a class="el" href="namespaceDGtal.html" title="DGtal is the top-level namespace which contains all DGtal functions and types.">DGtal</a> features</p>
<ul>
<li>Import/export of a volumetric image (<a class="el" href="structDGtal_1_1VolReader.html" title="Aim: implements methods to read a &quot;Vol&quot; file format.">VolReader</a> and <a class="el" href="structDGtal_1_1VolWriter.html" title="Aim: Export a 3D Image using the Vol formats.">VolWriter</a>)</li>
<li>Distance transformation computation (<a class="el" href="classDGtal_1_1DistanceTransformation.html" title="Aim: Implementation of the linear in time distance transformation for separable metrics.">DistanceTransformation</a>)</li>
<li>Visualization of volumetric data (<a class="el" href="classDGtal_1_1Viewer3D.html">Viewer3D</a>)</li>
<li>Implicit/parametric shape construction (<a class="el" href="classDGtal_1_1ImplicitBall.html" title="Aim: model of CEuclideanOrientedShape and CEuclideanBoundedShape concepts to create a ball in nD....">ImplicitBall</a>)</li>
<li>Shape analysis using granulometric function</li>
</ul>
<p >Please use the following template file for this tutorial: <a class="el" href="volDTGranulo-template_8cpp_source.html">volDTGranulo-template.cpp</a></p>
<h1><a class="anchor" id="tutosectIntroGranulo"></a>
Introduction</h1>
<p >When analyzing 3D porous material, the granulometric function plays an important role for shape description. For short, given a shape \(
\mathcal{X}\), the granulometric function at a point \( x\in \mathcal{X}\) is given by:  </p><p class="formulaDsp">
\[ 
 g (x) = \max \{ r~|~ \forall c\in\mathcal{X}, x\in B(c,r)\text{ and }\forall B(c,r)\subseteq \mathcal{X}\}
\]
</p>
<p> \( B(c,r)\) being an Euclidean ball with center \( c\) and radius \( r\).</p>
<div class="image">
<img src="export-accflower.png" alt=""/>
<div class="caption">
Granulometry function on a 2D shape</div></div>
 <div class="image">
<img src="Al-thickness.png" alt=""/>
<div class="caption">
Granulometry function on Al object</div></div>
 <div class="image">
<img src="volumetricThickness.png" alt=""/>
<div class="caption">
Granulometry function on</div></div>
<p> interior/exterior of a porous material (snow sample, courtesy of GAME-CNRM/CEN and ESRF)  interior/exterior of a porous material (snow sample, courtesy of GAME-CNRM/CEN and ESRF)</p>
<p >To compute the granulometric function, a classical approach is to first consider the medial axis of \( \mathcal{X}\) (the medial axis can be roughly defined as the set of maximal balls contained in the shape).</p>
<p >In this tutorial, we will implement a first naive approach from distance transformation values. The distance transformation is a function defined by  </p><p class="formulaDsp">
\[ 
 DT (x) = \min \{ d(x,\hat{x}~|~ x\in\mathcal{X}\text{ and }\hat{x}\in \mathbb{R}^n\setminus \mathcal{X}\}
\]
</p>
<p> for some metric \( d\).</p>
<p >Hence, instead of checking all Euclidean balls inside \( \mathcal{X}\), we can just consider the digital balls \( B(x, DT(x))\) for all \(
x\in\mathcal{X}\) (in this case, \( d \) is the \(l_2\) Euclidean norm).</p>
<h1><a class="anchor" id="VDTG_tutosectLoadVol"></a>
Import volumetric image an visualization</h1>
<p >Let start with volumetric image loading. First of all, create a source file with the following includes (or copy the volDTGranulo-tempate.cpp source file):</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;DGtal/base/Common.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/helpers/StdDefs.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/images/ImageContainerBySTLVector.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/io/readers/VolReader.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/io/writers/VolWriter.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/images/SimpleThresholdForegroundPredicate.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/geometry/volumes/distance/DistanceTransformation.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/shapes/implicit/ImplicitBall.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;DGtal/base/BasicFunctors.h&quot;</span></div>
</div><!-- fragment --><ol type="1">
<li>Define a type (<em>typedef</em>) for the image container you want to use (<a class="el" href="classDGtal_1_1ImageContainerBySTLVector.html">ImageContainerBySTLVector</a>, <a class="el" href="classDGtal_1_1ImageContainerBySTLMap.html">ImageContainerBySTLMap</a>, ....)</li>
<li>Use the <a class="el" href="structDGtal_1_1VolReader.html" title="Aim: implements methods to read a &quot;Vol&quot; file format.">VolReader</a> to load a volumetric file and store it into a previously defined image type.</li>
</ol>
<p >Once you have imported the volumetric file, you can check its geometry with the internal <a class="el" href="classDGtal_1_1Viewer3D.html">Viewer3D</a> visualization tool. First of all, create a new viewer instance using the following code:</p>
<div class="fragment"><div class="line">  <span class="comment">//Create a new viewer instance</span></div>
<div class="line">  QApplication application(argc,argv);</div>
<div class="line">  Viewer3D&lt;&gt; viewer;</div>
<div class="line">  viewer.show();</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Please have a look to <a class="el" href="moduleDisplay3D.html">Display3D: a stream mechanism for displaying 3D DGtal objects</a> for more details on <a class="el" href="namespaceDGtal.html" title="DGtal is the top-level namespace which contains all DGtal functions and types.">DGtal</a> viewer.</dd></dl>
<p>At this point, just send to the viewer the grid points with strictly positive values.</p>
<h1><a class="anchor" id="tutosecDT"></a>
Distance Transformation</h1>
<ol type="1">
<li>First of all, have a look to the <a class="el" href="classDGtal_1_1DistanceTransformation.html" title="Aim: Implementation of the linear in time distance transformation for separable metrics.">DistanceTransformation</a> class and check the template type you have to specified to this class to create an instance.</li>
<li>As you may have seen, one of the input is a binary predicate which characterizes the shape (model of <a class="el" href="structDGtal_1_1concepts_1_1CPointPredicate.html" title="Aim: Defines a predicate on a point.">concepts::CPointPredicate</a> concept). Use the <a class="el" href="classDGtal_1_1functors_1_1SimpleThresholdForegroundPredicate.html" title="Aim: Define a simple Foreground predicate thresholding image values given a single thresold....">functors::SimpleThresholdForegroundPredicate</a> to create a point predicate from an image and a thresold.</li>
<li>Now, create a distance map from this point predicate and an Eucildean \( l_2\) norm.</li>
<li>Create a new <a class="el" href="classDGtal_1_1Viewer3D.html">Viewer3D</a> instance and visualize the distance map values. Two things would be helpful:<ul>
<li>If you want to add a clipping plane to the viewer, a simple object has been defined in <a class="el" href="namespaceDGtal.html" title="DGtal is the top-level namespace which contains all DGtal functions and types.">DGtal</a>: <div class="fragment"><div class="line">viewer &lt;&lt; <a class="code hl_struct" href="structDGtal_1_1ClippingPlane.html">DGtal::ClippingPlane</a>(1,0,0,-10.1);</div>
<div class="ttc" id="astructDGtal_1_1ClippingPlane_html"><div class="ttname"><a href="structDGtal_1_1ClippingPlane.html">DGtal::ClippingPlane</a></div><div class="ttdoc">Class for adding a Clipping plane through the Viewer3D stream. Realizes the concept CDrawableWithView...</div><div class="ttdef"><b>Definition:</b> <a href="DrawWithDisplay3DModifier_8h_source.html#l00156">DrawWithDisplay3DModifier.h:157</a></div></div>
</div><!-- fragment --></li>
<li>The following code will create a nice colormap to map DT values to colors. <div class="fragment"><div class="line">  <span class="comment">//Create the colormap from the maximal distance value</span></div>
<div class="line">  <span class="comment">//and a GradientColorMap</span></div>
<div class="line">  DT::Value maxDT = (*boost::first_max_element(distancemap.constRange().begin(), </div>
<div class="line">                                       distancemap.constRange().end()));</div>
<div class="line">  GradientColorMap&lt;DT::Value&gt; gradient( 0, maxDT);</div>
<div class="line">  gradient.addColor(<a class="code hl_variable" href="classDGtal_1_1Color.html#abf76f3f60747766c469ceb8e9bbfe68b">DGtal::Color::Blue</a>);</div>
<div class="line">  gradient.addColor(<a class="code hl_variable" href="classDGtal_1_1Color.html#a7b64e5703b4119bf395d739903ed488f">DGtal::Color::Green</a>);</div>
<div class="line">  gradient.addColor(<a class="code hl_variable" href="classDGtal_1_1Color.html#a35033e3e774db6782e0f030179a9f7cf">DGtal::Color::Yellow</a>);</div>
<div class="line">  gradient.addColor(<a class="code hl_variable" href="classDGtal_1_1Color.html#aa5e8679bd0da49f95d13cd95a17b619b">DGtal::Color::Red</a>);</div>
<div class="ttc" id="aclassDGtal_1_1Color_html_a35033e3e774db6782e0f030179a9f7cf"><div class="ttname"><a href="classDGtal_1_1Color.html#a35033e3e774db6782e0f030179a9f7cf">DGtal::Color::Yellow</a></div><div class="ttdeci">static const Color Yellow</div><div class="ttdef"><b>Definition:</b> <a href="Color_8h_source.html#l00422">Color.h:422</a></div></div>
<div class="ttc" id="aclassDGtal_1_1Color_html_a7b64e5703b4119bf395d739903ed488f"><div class="ttname"><a href="classDGtal_1_1Color.html#a7b64e5703b4119bf395d739903ed488f">DGtal::Color::Green</a></div><div class="ttdeci">static const Color Green</div><div class="ttdef"><b>Definition:</b> <a href="Color_8h_source.html#l00417">Color.h:417</a></div></div>
<div class="ttc" id="aclassDGtal_1_1Color_html_aa5e8679bd0da49f95d13cd95a17b619b"><div class="ttname"><a href="classDGtal_1_1Color.html#aa5e8679bd0da49f95d13cd95a17b619b">DGtal::Color::Red</a></div><div class="ttdeci">static const Color Red</div><div class="ttdef"><b>Definition:</b> <a href="Color_8h_source.html#l00416">Color.h:416</a></div></div>
<div class="ttc" id="aclassDGtal_1_1Color_html_abf76f3f60747766c469ceb8e9bbfe68b"><div class="ttname"><a href="classDGtal_1_1Color.html#abf76f3f60747766c469ceb8e9bbfe68b">DGtal::Color::Blue</a></div><div class="ttdeci">static const Color Blue</div><div class="ttdef"><b>Definition:</b> <a href="Color_8h_source.html#l00419">Color.h:419</a></div></div>
</div><!-- fragment --></li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="tutosecShape"></a>
Granulometric function</h1>
<p >As discussed in the introduction, we will implement a very naive version of the granulometric function extraction. The main idea is to construct an image storing the \( g\) function. The algorithm is the following one:</p>
<ul>
<li>Initiaize the map \(g\) with 0 at each point</li>
<li>For each grid points \( x \) in the object<ul>
<li>Create a Ball centered at \(x\) with radius \(DT(x)\)</li>
<li>Iteratate over all points \(y \) in this ball<ul>
<li>If the value \( g(y)\) is less than \(DT(x)\), set \( g(y)=DT(x)\)</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol type="1">
<li>Create an empty image \( g\) with the same size as the input vol file.</li>
<li>Create a first ball (e.g. centered in the middle of the image) using the <a class="el" href="classDGtal_1_1ImplicitBall.html" title="Aim: model of CEuclideanOrientedShape and CEuclideanBoundedShape concepts to create a ball in nD....">ImplicitBall</a> class. This class creates an implicit ball such that the () operator is posivive at a point if the point is inside the shape (model of CBoundedEuclideanShape). A basic way to scan grid points inside an <a class="el" href="classDGtal_1_1ImplicitBall.html" title="Aim: model of CEuclideanOrientedShape and CEuclideanBoundedShape concepts to create a ball in nD....">ImplicitBall</a> is to construct a Domain from its bounding box, then you scan all points in this domain and check the operator() sign to decide if the point is inside or not.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>More advanced digitization processes are given by <a class="el" href="classDGtal_1_1GaussDigitizer.html" title="Aim: A class for computing the Gauss digitization of some Euclidean shape, i.e. its intersection with...">GaussDigitizer</a>.</dd></dl>
<ol type="1">
<li>Implement the above mentioned granulometric function algorithm: at each point of the DT map, create a ball and check its interior point to update the function \( g \).</li>
<li>Again, use a new <a class="el" href="classDGtal_1_1Viewer3D.html">Viewer3D</a> object to visualize the granulometric function.</li>
<li>Export the final map to a vol file. In this case, consider the <a class="el" href="structDGtal_1_1VolWriter.html" title="Aim: Export a 3D Image using the Vol formats.">VolWriter</a> class (<em>granuloImage</em> is the name of image structure storing the \(g \) map):</li>
</ol>
<div class="fragment"><div class="line">  VolWriter&lt;Image, CastFunctor&lt;unsigned char&gt; &gt;::exportVol(<span class="stringliteral">&quot;granulo.vol&quot;</span>, imageGranulo);     </div>
</div><!-- fragment --><ol type="1">
<li>What is the computational cost of this naive approach for a shape defined in a \(N^3\) domain ?</li>
</ol>
<h1><a class="anchor" id="volDTSecCCL"></a>
Conclusion</h1>
<p >You can check <a class="el" href="volDTGranulo_8cpp_source.html">volDTGranulo.cpp</a> to get some answers to the above mentioned questions.</p>
<p >Several optimizations can be developed. For example, before constructing the granulometric function, one can use medial axis extraction to drastically reduce the number of balls to scan. Then, sorting the balls by their radii may be helpful to implement fast propagation based granulometric/thickness function from the <a class="el" href="classDGtal_1_1PowerMap.html" title="Aim: Implementation of the linear in time Power map construction.">PowerMap</a> (see for instance <a class="el" href="citelist.html#CITEREF_Liris-5700">[33]</a>). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 17 2022 17:06:51 for DGtal by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
